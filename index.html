<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WhisperWeb</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #0d0d0d;
      color: #eee;
      font-family: 'Courier New', monospace;
      overflow: hidden;
    }
    .whisper-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      padding: 20px;
      text-align: center;
    }
    .whisper-title {
      font-size: 3rem;
      margin-bottom: 2rem;
      animation: glitch 1s infinite alternate;
    }
    .whispers {
      font-size: 1.25rem;
      max-width: 600px;
      line-height: 1.6;
    }
    @keyframes glitch {
      0% { text-shadow: 1px 0 red; }
      100% { text-shadow: -1px 0 blue; }
    }
  </style>
</head>
<body>
  <div class="whisper-container">
    <h1 class="whisper-title">WhisperWeb</h1>
    <div id="whispers" class="whispers">Listening...</div>
  </div>

  <script>
    const whispers = document.getElementById('whispers');

    // Idle detection
    let idleTime = 0;
    setInterval(() => {
      idleTime++;
      if (idleTime === 10) whisper("You've been quiet...");
      if (idleTime === 30) whisper("Still here? We are.");
    }, 1000);

    document.onmousemove = document.onkeydown = () => idleTime = 0;

    // Microphone setup
    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const source = audioContext.createMediaStreamSource(stream);
      const analyser = audioContext.createAnalyser();
      source.connect(analyser);
      const data = new Uint8Array(analyser.frequencyBinCount);

      setInterval(() => {
        analyser.getByteFrequencyData(data);
        const volume = data.reduce((a, b) => a + b) / data.length;
        if (volume > 30) whisper("I heard that.");
        if (volume > 60) whisper("Something moved.");
        if (volume > 100) whisper("Youâ€™re not alone.");
      }, 2000);

    }).catch(err => {
      whisper("Can't hear you. Did you block me?");
    });

    // Whispering function
    function whisper(msg) {
      const line = document.createElement('p');
      line.textContent = msg;
      whispers.appendChild(line);
      whispers.scrollTop = whispers.scrollHeight;
    }
  </script>
</body>
</html>
